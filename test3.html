<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <title>Cata VR - Gorri贸n Wine Experience</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- A-Frame (compatible con WebXR Viewer) -->
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>

    <style>
      body {
        margin: 0;
        overflow: hidden;
        background-color: black;
        font-family: sans-serif;
      }
      #enter-vr-btn {
        position: absolute;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        background-color: #9b2b2b;
        color: white;
        border: none;
        padding: 14px 22px;
        font-size: 16px;
        border-radius: 8px;
        cursor: pointer;
        z-index: 999;
      }
      #enter-vr-btn:hover {
        background-color: #d45b5b;
      }
    </style>
  </head>

  <body>
    <a-scene
      vr-mode-ui="enabled: true"
      loading-screen="dotsColor: #9b2b2b; backgroundColor: black"
    >
      <!-- Fondo 360掳 -->
      <a-sky
        src="playa.jpg"
        rotation="0 -90 0"
        material="shader: flat; side: back;"
      ></a-sky>

      <!-- Luz ambiental -->
      <a-entity light="type: ambient; color: #FFF"></a-entity>

      <!-- Texto de bienvenida flotante -->
      <a-text
        id="texto-bienvenida"
        value=" Bienvenido a la Cata VR Gorri贸n Wine Experience "
        align="center"
        color="#ffffff"
        position="0 2 -3"
        width="6"
        opacity="1"
        animation__flotar="property: position; dir: alternate; dur: 4000; easing: easeInOutSine; loop: true; to: 0 2.2 -3"
      ></a-text>

      <!-- Punto interactivo animado -->
      <a-sphere
        id="boton-cata"
        position="0 1.5 -3"
        radius="0.25"
        color="#9b2b2b"
        event-set__enter="_event: mouseenter; color: #d45b5b"
        event-set__leave="_event: mouseleave; color: #9b2b2b"
        sound="on: click; src: #audio-narracion"
        animation="property: rotation; to: 0 360 0; loop: true; dur: 8000; easing: linear"
      ></a-sphere>

      <!-- Texto gu铆a -->
      <a-text
        value="Mira el c铆rculo para comenzar la cata"
        align="center"
        color="#fff"
        position="0 0.9 -3"
        width="4"
      ></a-text>

      <!-- Audio narraci贸n cinematogr谩fica (voz + vi帽edo + m煤sica) -->
      <audio
        id="audio-narracion"
        src="https://cdn.gorrionwineexperience.com/audio/cata-puglia-bienvenida.mp3"
      ></audio>

      <!-- Audio ambiental de bodega -->
      <audio
        id="audio-ambiente"
        src="https://cdn.pixabay.com/download/audio/2023/04/10/audio_ae937425e9.mp3?filename=wine-cellar-ambient-143397.mp3"
        loop
      ></audio>

      <!-- C谩mara + Cursor -->
      <a-entity camera look-controls="magicWindowTrackingEnabled: true">
        <a-cursor
          fuse="true"
          fuse-timeout="1500"
          material="color: white; shader: flat"
        ></a-cursor>
      </a-entity>
    </a-scene>

    <!-- Bot贸n de entrada a modo VR -->
    <button id="enter-vr-btn">Entrar en modo VR</button>

    <script>
      const scene = document.querySelector("a-scene");
      const vrButton = document.getElementById("enter-vr-btn");
      const ambientAudio = document.getElementById("audio-ambiente");
      const narration = document.getElementById("audio-narracion");
      const textoBienvenida = document.getElementById("texto-bienvenida");

      const isWebXRViewer = /WebXRViewer/i.test(navigator.userAgent);
      const isIOS = /iPhone|iPad|iPod/i.test(navigator.userAgent);

      if (!isWebXRViewer && isIOS) {
        vrButton.textContent =
          "Modo VR no disponible en Safari iPhone. Usa WebXR Viewer ";
      }

      // Al entrar en VR: iniciar sonidos y texto
      vrButton.addEventListener("click", async () => {
        try {
          await ambientAudio.play();
          await narration.play();
        } catch (err) {
          console.log("Audio bloqueado hasta interacci贸n:", err);
        }
        if (scene && scene.enterVR) {
          scene.enterVR();
          vrButton.style.display = "none";
        }

        // Al terminar la narraci贸n, hacer fade del texto
        narration.addEventListener("ended", () => {
          textoBienvenida.setAttribute(
            "animation__fade",
            "property: opacity; from: 1; to: 0; dur: 3000; easing: easeInOutQuad"
          );
        });
      });

      // Detener sonido al salir de VR
      scene.addEventListener("exit-vr", () => {
        vrButton.style.display = "block";
        ambientAudio.pause();
        narration.pause();
      });
    </script>
  </body>
</html>
